@{
    ViewBag.Title = "Speech to Text";
}

<h2>Speech to Text</h2>

<button id="startRecord">Start Recording</button>
<p><strong>Transcription:</strong> <span id="transcriptionResult"></span></p>

<script>
    let mediaRecorder;
    let audioChunks = [];

    document.getElementById("startRecord").addEventListener("click", async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = e => {
            audioChunks.push(e.data);
        };

        mediaRecorder.onstop = async () => {
            const blob = new Blob(audioChunks, { type: 'audio/wav' });
            const formData = new FormData();
            formData.append('audioFile', blob, 'recording.wav');

            const response = await fetch('/Voice/STT', {
                method: 'POST',
                body: formData
            });

            const result = await response.text();
            document.getElementById("transcriptionResult").innerText = result;
        };

        audioChunks = [];
        mediaRecorder.start();

        setTimeout(() => {
            mediaRecorder.stop();
        }, 5000); // 5 seconds
    });
</script>
